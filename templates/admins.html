{% extends "layout.html" %}
{% block title %}قائمة المسؤولين{% endblock %}
{% block content %}
<link href="{{ url_for('static', filename='toolsstyle.css') }}" rel="stylesheet">
<h1>قائمة المسؤولين</h1>

{% if message %}
    <div class="flash-messages">
        <div class="alert alert-{{ message_type }} mt-3">{{ message }}</div>
    </div>
{% endif %}

<table class="table table-striped table-hover">
    <thead class="thead-dark">
        <tr>
            <th>المعرف</th>
            <th>الاسم</th>
            <th>البريد الإلكتروني</th>
            <th>رقم الهاتف</th>
            <th>العمليات</th>
        </tr>
    </thead>
    <tbody>
        {% for admin in admins %}
        <tr>
            <td>{{ admin.admin_id }}</td>
            <td>{{ admin.name }}</td>
            <td>{{ admin.email }}</td>
            <td>{{ admin.phone_number }}</td>
            <td>
                <button class="btn btn-edit btn-sm"
                    data-toggle="modal"
                    data-target="#editModal"
                    data-id="{{ admin.admin_id }}"
                    data-name="{{ admin.name }}"
                    data-email="{{ admin.email }}"
                    data-phone_number="{{ admin.phone_number }}">
                    تعديل
                </button>
                <a href="{{ url_for('delete_admin', admin_id=admin.admin_id) }}" class="btn btn-delete btn-sm"
                   onclick="return confirm('هل أنت متأكد أنك تريد حذف هذا المسؤول؟')">
                    حذف
                </a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- Edit Admin Modal -->
<div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="editModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editModalLabel">تعديل المسؤول</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form id="editAdminForm" method="POST" action="{{ url_for('update_admin') }}">
                <div class="modal-body">
                    <input type="hidden" name="admin_id" id="edit-id">
                    <div class="form-group">
                        <label for="edit-name">الاسم</label>
                        <input type="text" class="form-control" name="name" id="edit-name" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-email">البريد الإلكتروني</label>
                        <input type="email" class="form-control" name="email" id="edit-email" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-phone_number">رقم الهاتف</label>
                        <input type="text" class="form-control" name="phone_number" id="edit-phone_number" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">إغلاق</button>
                    <button type="submit" class="btn btn-primary">حفظ التغييرات</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    $('#editModal').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget);
        var id = button.data('id');
        var name = button.data('name');
        var email = button.data('email');
        var phone_number = button.data('phone_number');
        
        var modal = $(this);
        modal.find('#edit-id').val(id);
        modal.find('#edit-name').val(name);
        modal.find('#edit-email').val(email);
        modal.find('#edit-phone_number').val(phone_number);
    });
});
</script>
{% endblock %}
